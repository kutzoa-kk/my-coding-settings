# データベース設計書テンプレート

## プロジェクト情報

**プロジェクト名**: [プロジェクト名]  
**データベース名**: [データベース名]  
**バージョン**: [バージョン]  
**作成日**: [作成日]  
**作成者**: [作成者]  
**承認者**: [承認者]  
**最終更新日**: [最終更新日]

## 1. データベース概要

### 1.1 目的
[データベースの目的を記述]

### 1.2 基本情報
- **DBMS**: [MySQL/PostgreSQL/Oracle等]
- **バージョン**: [バージョン]
- **文字エンコーディング**: UTF-8
- **照合順序**: utf8mb4_unicode_ci

### 1.3 設計方針
- [設計方針1]
- [設計方針2]
- [設計方針3]

## 2. ER図

### 2.1 全体ER図
```
[全体ER図を挿入]
```

### 2.2 エンティティ関係
| エンティティ1 | 関係 | エンティティ2 | 多重度 |
|---------------|------|---------------|--------|
| [エンティティ1] | [関係] | [エンティティ2] | [多重度] |
| [エンティティ2] | [関係] | [エンティティ3] | [多重度] |

## 3. テーブル定義

### 3.1 テーブル一覧
| No | テーブル名 | 概要 | 主キー | インデックス数 |
|----|------------|------|--------|----------------|
| T001 | [テーブル名] | [概要] | [主キー] | [数] |
| T002 | [テーブル名] | [概要] | [主キー] | [数] |

### 3.2 テーブル詳細

#### T001: users
**概要**: ユーザー情報を管理するテーブル

**カラム定義**:
| カラム名 | データ型 | 制約 | デフォルト | 概要 |
|----------|----------|------|------------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | ユーザーID |
| name | VARCHAR(100) | NOT NULL | - | ユーザー名 |
| email | VARCHAR(255) | NOT NULL, UNIQUE | - | メールアドレス |
| password_hash | VARCHAR(255) | NOT NULL | - | パスワードハッシュ |
| created_at | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新日時 |

**インデックス**:
| インデックス名 | カラム | 種別 | 概要 |
|----------------|--------|------|------|
| idx_users_email | email | UNIQUE | メールアドレス検索用 |
| idx_users_created_at | created_at | INDEX | 作成日時検索用 |

**外部キー制約**:
- なし

#### T002: user_profiles
**概要**: ユーザープロフィール情報を管理するテーブル

**カラム定義**:
| カラム名 | データ型 | 制約 | デフォルト | 概要 |
|----------|----------|------|------------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | プロフィールID |
| user_id | BIGINT | NOT NULL, FOREIGN KEY | - | ユーザーID |
| age | INT | NULL | - | 年齢 |
| gender | ENUM('male', 'female', 'other') | NULL | - | 性別 |
| address | TEXT | NULL | - | 住所 |
| phone | VARCHAR(20) | NULL | - | 電話番号 |
| created_at | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新日時 |

**インデックス**:
| インデックス名 | カラム | 種別 | 概要 |
|----------------|--------|------|------|
| idx_user_profiles_user_id | user_id | INDEX | ユーザーID検索用 |

**外部キー制約**:
| 制約名 | カラム | 参照テーブル | 参照カラム | 削除時動作 |
|--------|--------|--------------|------------|------------|
| fk_user_profiles_user_id | user_id | users | id | CASCADE |

## 4. データ型定義

### 4.1 基本データ型
| データ型 | 説明 | 使用例 |
|----------|------|--------|
| BIGINT | 64ビット整数 | ID、カウント |
| VARCHAR(n) | 可変長文字列 | 名前、メールアドレス |
| TEXT | 長文テキスト | 説明文、コメント |
| TIMESTAMP | 日時 | 作成日時、更新日時 |
| ENUM | 列挙型 | ステータス、性別 |

### 4.2 カスタムデータ型
| データ型名 | 定義 | 用途 |
|------------|------|------|
| user_status | ENUM('active', 'inactive', 'suspended') | ユーザーステータス |
| order_status | ENUM('pending', 'confirmed', 'shipped', 'delivered') | 注文ステータス |

## 5. 制約・ルール

### 5.1 主キー制約
- すべてのテーブルに主キーを設定
- 主キーは自動採番（AUTO_INCREMENT）を使用
- 複合主キーは避ける

### 5.2 外部キー制約
- 参照整合性を保証
- 削除時はCASCADEまたはSET NULL
- 循環参照を避ける

### 5.3 チェック制約
| テーブル | カラム | 制約 | 説明 |
|----------|--------|------|------|
| users | email | REGEXP | メールアドレス形式 |
| user_profiles | age | age >= 0 AND age <= 150 | 年齢範囲 |
| orders | amount | amount >= 0 | 金額は0以上 |

### 5.4 ユニーク制約
| テーブル | カラム | 説明 |
|----------|--------|------|
| users | email | メールアドレスは一意 |
| products | sku | 商品コードは一意 |

## 6. インデックス設計

### 6.1 インデックス戦略
- 主キーには自動的にクラスター化インデックス
- 外部キーにはインデックスを設定
- 検索条件でよく使用されるカラムにインデックス
- 複合インデックスは左端一致で使用

### 6.2 インデックス一覧
| テーブル | インデックス名 | カラム | 種別 | 用途 |
|----------|----------------|--------|------|------|
| users | idx_users_email | email | UNIQUE | メールアドレス検索 |
| users | idx_users_created_at | created_at | INDEX | 作成日時検索 |
| orders | idx_orders_user_id | user_id | INDEX | ユーザー別注文検索 |
| orders | idx_orders_status_date | status, created_at | INDEX | ステータス・日時検索 |

## 7. パフォーマンス設計

### 7.1 パーティショニング
| テーブル | パーティション方式 | パーティションキー | 説明 |
|----------|-------------------|-------------------|------|
| logs | RANGE | created_at | 月単位でパーティション |
| orders | HASH | user_id | ユーザーIDで分散 |

### 7.2 アーカイブ戦略
| テーブル | アーカイブ条件 | アーカイブ先 | 説明 |
|----------|----------------|--------------|------|
| logs | 1年以上前 | archive_logs | 古いログをアーカイブ |
| sessions | 30日以上前 | archive_sessions | 古いセッションをアーカイブ |

### 7.3 キャッシュ戦略
| データ | キャッシュ方式 | TTL | 説明 |
|--------|----------------|-----|------|
| ユーザー情報 | Redis | 1時間 | 頻繁にアクセスされる |
| 商品情報 | Redis | 30分 | 価格変更時は即座に更新 |

## 8. セキュリティ設計

### 8.1 アクセス制御
| ユーザー | 権限 | 対象テーブル | 操作 |
|----------|------|--------------|------|
| app_user | SELECT, INSERT, UPDATE | users | 自分のレコードのみ |
| app_admin | ALL | all | 全テーブル |
| backup_user | SELECT | all | バックアップ用 |

### 8.2 データ暗号化
| テーブル | カラム | 暗号化方式 | 説明 |
|----------|--------|------------|------|
| users | password_hash | bcrypt | パスワードハッシュ |
| user_profiles | phone | AES-256 | 電話番号暗号化 |

### 8.3 監査ログ
| テーブル | 監査項目 | ログテーブル | 説明 |
|----------|----------|--------------|------|
| users | INSERT, UPDATE, DELETE | audit_users | ユーザー変更履歴 |
| orders | INSERT, UPDATE, DELETE | audit_orders | 注文変更履歴 |

## 9. バックアップ・復旧

### 9.1 バックアップ戦略
| バックアップ種別 | 頻度 | 保持期間 | 説明 |
|------------------|------|----------|------|
| フルバックアップ | 週1回 | 1ヶ月 | 完全バックアップ |
| 増分バックアップ | 日1回 | 1週間 | 変更分のみ |
| トランザクションログ | 15分 | 1日 | ログバックアップ |

### 9.2 復旧手順
1. フルバックアップから復旧
2. 増分バックアップを適用
3. トランザクションログを適用
4. 整合性チェック

## 10. 付録

### 10.1 参考資料
- [資料1]: [URL]
- [資料2]: [URL]

### 10.2 変更履歴
| 日付 | バージョン | 変更内容 | 変更者 |
|------|------------|----------|--------|
| [日付] | [バージョン] | [変更内容] | [変更者] |

---

**承認**
- データベース設計者: [署名] [日付]
- 開発責任者: [署名] [日付]
- セキュリティ責任者: [署名] [日付]
